{"swagger":"2.0","info":{"description":"Usumu is a self-hosted newsletter subscription microservice. It contains no authentication or authorization features, its only job is to store subscriber data securely.","version":"1.x","title":"Usumu API"},"host":"localhost:8080","basePath":"/","tags":[{"name":"Logs","description":"Retreive transaction logs for a certain subscriber (email, phone)."},{"name":"Metadata","description":"Store metadata for subscribers."},{"name":"Newsletter","description":"Manage and send out newsletters."},{"name":"Subscriptions","description":"Create, verify, list, retreive or delete subscriptions."}],"paths":{"/newsletters":{"get":{"tags":["Newsletter"],"summary":"List newsletters","description":"List all newsletters in the system.","operationId":"listNewsletters","produces":["*/*","application/json"],"responses":{"200":{"description":"A newsletter successfully created.","schema":{"$ref":"#/definitions/NewsletterListResponse"}}},"deprecated":false},"post":{"tags":["Newsletter"],"summary":"Create a new newsletter.","description":"Create a new newsletter by providing templates in Thymeleaf format. Subscriber metadata can be accessed as variables.","operationId":"createNewsletter","consumes":["application/json"],"produces":["*/*","application/json"],"parameters":[{"name":"filterKey","in":"query","description":"Only send out newsletter to subscribers who have this metadata key.","required":false,"type":"string","allowEmptyValue":false},{"name":"filterValue","in":"query","description":"Only send out newsletter to subscribers who have this metadata value for the key specified in filterKey","required":false,"type":"string","allowEmptyValue":false},{"name":"htmlTemplate","in":"query","description":"Template for the HTML part of the e-mail","required":true,"type":"string","allowEmptyValue":false},{"name":"smsTemplate","in":"query","description":"Template for SMS","required":true,"type":"string","allowEmptyValue":false},{"name":"subject","in":"query","description":"Subject template for the e-mail","required":true,"type":"string","allowEmptyValue":false},{"name":"textTemplate","in":"query","description":"Template for the text part of the e-mail","required":true,"type":"string","allowEmptyValue":false}],"responses":{"200":{"description":"A newsletter successfully created.","schema":{"$ref":"#/definitions/NewsletterCreateResponse"}}},"deprecated":false}},"/newsletters/{id}":{"get":{"tags":["Newsletter"],"summary":"Retrieve a single newsletter","description":"Retrieve the status of a single newsletter","operationId":"getNewsletter","produces":["*/*","application/json"],"parameters":[{"name":"id","in":"path","description":"Newsletter ID","required":true,"type":"string"}],"responses":{"200":{"description":"A newsletter successfully created.","schema":{"$ref":"#/definitions/NewsletterGetResponse"}}},"deprecated":false},"patch":{"tags":["Newsletter"],"summary":"Update/send a newsletter.","description":"Update or send. Templates can be supplied in Thymeleaf format. Sending can be triggered using the 'send' parameter.","operationId":"updateNewsletter","consumes":["application/json"],"produces":["*/*","application/json"],"parameters":[{"name":"filterKey","in":"query","description":"Only send out newsletter to subscribers who have this metadata key. Note that this can only be changed while the newsletter is in the NEW status.","required":false,"type":"string","allowEmptyValue":false},{"name":"filterValue","in":"query","description":"Only send out newsletter to subscribers who have this metadata value for the key specified in filterKey. Note that this can only be changed while the newsletter is in the NEW status.","required":false,"type":"string","allowEmptyValue":false},{"name":"htmlTemplate","in":"query","description":"Template for the HTML part of the e-mail","required":false,"type":"string","allowEmptyValue":false},{"name":"id","in":"path","description":"Id of the newsletter","required":true,"type":"string"},{"name":"send","in":"query","description":"Set to true to start the sending process. Set to false to pause a sending. While sending the templates cannot be updated.","required":false,"type":"boolean","allowEmptyValue":false},{"name":"smsTemplate","in":"query","description":"Template for SMS","required":false,"type":"string","allowEmptyValue":false},{"name":"subject","in":"query","description":"Subject template for the e-mail","required":false,"type":"string","allowEmptyValue":false},{"name":"textTemplate","in":"query","description":"Template for the text part of the e-mail","required":false,"type":"string","allowEmptyValue":false}],"responses":{"200":{"description":"A newsletter successfully updated.","schema":{"$ref":"#/definitions/NewsletterCreateResponse"}},"404":{"description":"The newsletter was not found.","schema":{"$ref":"#/definitions/ApiError"}}},"deprecated":false}},"/newsletters/{id}/preview/{value}":{"get":{"tags":["Newsletter"],"summary":"Preview a newsletter","description":"Preview a newsletter with a set of metadata","operationId":"previewNewsletter","produces":["*/*","application/json"],"parameters":[{"name":"id","in":"path","description":"Newsletter ID","required":true,"type":"string"},{"name":"value","in":"path","description":"Subscriber ID, or subscriber info (EMAIL or PHONE in international number) to use for preview.","required":true,"type":"string"}],"responses":{"200":{"description":"The rendered newsletter.","schema":{"$ref":"#/definitions/NewsletterPreviewResponse"}},"404":{"description":"The newsletter was not found.","schema":{"$ref":"#/definitions/ApiError"}}},"deprecated":false}},"/subscriptions":{"get":{"tags":["Subscriptions"],"summary":"List subscriptions","description":"List all subscriptions in the system, either confirmed or unconfirmed. The response is paginated.","operationId":"listSubscriptions","produces":["*/*","application/json"],"parameters":[{"name":"itemCount","in":"query","description":"The number of items to return","required":false,"type":"integer","format":"int32","allowEmptyValue":false},{"name":"offset","in":"query","description":"Items to skip from the start","required":false,"type":"integer","format":"int32","allowEmptyValue":false}],"responses":{"200":{"description":"A list of current subscriptions is returned.","schema":{"$ref":"#/definitions/SubscriptionListResponse"}}},"deprecated":false},"post":{"tags":["Subscriptions"],"summary":"Create a subscription","description":"Create a subscription by providing the subscription type (EMAIL or SMS) and the contact details.The value in this case is either the phone number in international format, or the e-mail address.When the subscription is created a confirmation message is sent to the user to confirm theirsubscription.","operationId":"createSubscription","consumes":["application/json"],"produces":["*/*","application/json"],"parameters":[{"name":"type","in":"query","description":"Subscriber type.","required":true,"type":"string","allowEmptyValue":false,"enum":["EMAIL","SMS"]},{"name":"value","in":"query","description":"Subscriber contact info, EMAIL or SMS","required":true,"type":"string","allowEmptyValue":false}],"responses":{"200":{"description":"Created the subscription","schema":{"$ref":"#/definitions/SubscriptionCreateResponse"}}},"deprecated":false}},"/subscriptions/{value}":{"get":{"tags":["Subscriptions"],"summary":"Get a subscription","description":"Get a subscription by providing the subscription type (EMAIL or SMS).The value in this case is either the phone number in international format, or the e-mail address.","operationId":"getSubscription","produces":["*/*","application/json"],"parameters":[{"name":"value","in":"path","description":"Subscription ID, or subscriber contact info (EMAIL or PHONE in international format)","required":true,"type":"string"}],"responses":{"200":{"description":"Returns the subscription based on the e-mail address or phone number.","schema":{"$ref":"#/definitions/SubscriptionGetResponse"}},"404":{"description":"The subscription was not found with the details in question.","schema":{"$ref":"#/definitions/ApiError"}}},"deprecated":false},"delete":{"tags":["Subscriptions"],"summary":"Delete a subscription","description":"Delete a subscription by providing the subscription type (EMAIL or SMS).The value in this case is either the phone number in international format, or the e-mail address.","operationId":"deleteSubscription","produces":["*/*","application/json"],"parameters":[{"name":"value","in":"path","description":"Subscription ID, or subscriber contact info (EMAIL or PHONE in international format)","required":true,"type":"string"}],"responses":{"200":{"description":"Successfully deleted the subscription. The subscription logs are still preserved for accountability.","schema":{"$ref":"#/definitions/SubscriptionDeleteResponse"}},"404":{"description":"The subscription did not exist.","schema":{"$ref":"#/definitions/ApiError"}}},"deprecated":false},"patch":{"tags":["Subscriptions"],"summary":"Verify a subscription","description":"Verify a subscription by providing a verification code.","operationId":"verifySubscription","consumes":["application/json"],"produces":["*/*","application/json"],"parameters":[{"name":"value","in":"path","description":"Subscriber ID, or subscriber contact info (EMAIL or PHONE in international format)","required":true,"type":"string"},{"name":"verificationCode","in":"query","description":"Verification code for the address.","required":true,"type":"string","allowEmptyValue":false}],"responses":{"200":{"description":"Verification successful.","schema":{"$ref":"#/definitions/SubscriptionVerifyResponse"}},"400":{"description":"The verification code submitted is invalid, verification failed.","schema":{"$ref":"#/definitions/ApiError"}},"404":{"description":"The subscription with the e-mail or phone number does not exist.","schema":{"$ref":"#/definitions/ApiError"}}},"deprecated":false}},"/subscriptions/{value}/logs":{"get":{"tags":["Logs"],"summary":"List logs for subscriber","description":"List all log entries related to a subscription. These logs are preserved even after deletion as legal proof.","operationId":"listLogs","produces":["*/*","application/json"],"parameters":[{"name":"value","in":"path","description":"Subscription ID, or subscriber contact info (EMAIL or PHONE in international format)","required":true,"type":"string"}],"responses":{"200":{"description":"A list of all transactions related to a subscription.","schema":{"$ref":"#/definitions/SubscriptionLogListResponse"}}},"deprecated":false}},"/subscriptions/{value}/metadata":{"get":{"tags":["Metadata"],"summary":"Retrieve metadata for subscription","description":"Retrieve a set of key-value metadata entries for a subscription","operationId":"retrieveMetadata","produces":["*/*","application/json"],"parameters":[{"name":"value","in":"path","description":"Subscription ID, or subscriber contact info (EMAIL or PHONE in international format)","required":true,"type":"string"}],"responses":{"200":{"description":"The updated metadata is returned.","schema":{"$ref":"#/definitions/MetadataRetrieveResponse"}},"404":{"description":"The subscription was not found with the details in question.","schema":{"$ref":"#/definitions/ApiError"}}},"deprecated":false},"patch":{"tags":["Metadata"],"summary":"Update metadata for subscription","description":"Update the metadata for a subscription by supplying a set of key-value pairs available in templates.","operationId":"updateMetadata","consumes":["application/json"],"produces":["*/*","application/json"],"parameters":[{"name":"metadata","in":"query","description":"Metadata in key-value format","required":true,"items":{"type":"object","additionalProperties":{"type":"string"}},"allowEmptyValue":false},{"name":"value","in":"path","description":"Subscription ID, or subscriber contact info (EMAIL or PHONE in international format)","required":true,"type":"string"}],"responses":{"200":{"description":"The metadata was successfully updated.","schema":{"$ref":"#/definitions/MetadataUpdateResponse"}},"404":{"description":"The subscription was not found with the details in question.","schema":{"$ref":"#/definitions/ApiError"}}},"deprecated":false}}},"definitions":{"ApiError":{"type":"object","properties":{"errorCode":{"type":"string"},"errorMessage":{"type":"string"}},"title":"ApiError"},"MetadataRetrieveResponse":{"type":"object","properties":{"metadata":{"type":"object","additionalProperties":{"type":"string"}},"subscriptionId":{"type":"string"}},"title":"MetadataRetrieveResponse"},"MetadataUpdateResponse":{"type":"object","properties":{"metadata":{"type":"object","additionalProperties":{"type":"string"}},"subscriptionId":{"type":"string"}},"title":"MetadataUpdateResponse"},"Newsletter":{"type":"object","properties":{"htmlTemplate":{"type":"string"},"id":{"type":"string"},"smsTemplate":{"type":"string"},"status":{"type":"string","enum":["NEW","SENDING","PAUSED","SENT"]},"subject":{"type":"string"},"textTemplate":{"type":"string"}},"title":"Newsletter"},"NewsletterCreateResponse":{"type":"object","properties":{"newsletter":{"$ref":"#/definitions/Newsletter"}},"title":"NewsletterCreateResponse"},"NewsletterGetResponse":{"type":"object","properties":{"newsletter":{"$ref":"#/definitions/Newsletter"}},"title":"NewsletterGetResponse"},"NewsletterListResponse":{"type":"object","properties":{"newsletters":{"type":"array","items":{"$ref":"#/definitions/Newsletter"}}},"title":"NewsletterListResponse"},"NewsletterPreviewResponse":{"type":"object","properties":{"html":{"type":"string"},"sms":{"type":"string"},"subject":{"type":"string"},"text":{"type":"string"}},"title":"NewsletterPreviewResponse"},"Subscription":{"type":"object","properties":{"id":{"type":"string"},"status":{"type":"string","enum":["UNCONFIRMED","CONFIRMED","UNSUBSCRIBED"]},"type":{"type":"string","enum":["EMAIL","SMS"]},"value":{"type":"string"},"verificationCode":{"type":"string"}},"title":"Subscription"},"SubscriptionCreateResponse":{"type":"object","properties":{"subscription":{"$ref":"#/definitions/Subscription"}},"title":"SubscriptionCreateResponse"},"SubscriptionDeleteResponse":{"type":"object","properties":{"subscription":{"$ref":"#/definitions/Subscription"}},"title":"SubscriptionDeleteResponse"},"SubscriptionGetResponse":{"type":"object","properties":{"subscription":{"$ref":"#/definitions/Subscription"}},"title":"SubscriptionGetResponse"},"SubscriptionListResponse":{"type":"object","properties":{"subscriptions":{"type":"array","items":{"$ref":"#/definitions/Subscription"}},"totalItems":{"type":"integer","format":"int32"}},"title":"SubscriptionListResponse"},"SubscriptionLogEntry":{"type":"object","properties":{"id":{"type":"string"},"ipAddress":{"type":"string"},"newsletterId":{"type":"string"},"time":{"type":"string","format":"date-time"},"type":{"type":"string","enum":["CREATED","VERIFIED","NEWSLETTER","DELETED"]}},"title":"SubscriptionLogEntry"},"SubscriptionLogListResponse":{"type":"object","properties":{"entries":{"type":"array","items":{"$ref":"#/definitions/SubscriptionLogEntry"}}},"title":"SubscriptionLogListResponse"},"SubscriptionVerifyResponse":{"type":"object","properties":{"subscription":{"$ref":"#/definitions/Subscription"}},"title":"SubscriptionVerifyResponse"}}}